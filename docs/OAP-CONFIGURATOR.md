# OAP Configurator

The OAP (OFML Article Presentation) Configurator provides both CLI and TUI interfaces for configuring office furniture products using OFML product data.

## Overview

The OAP Configurator enables:
- **Product browsing**: Navigate manufacturers, series, and articles
- **Property configuration**: Set dimension, material, and color properties
- **Variant code generation**: Generate OFML-compatible variant codes
- **Price lookup**: Fetch prices from EBASE databases
- **Configuration export**: Save configurations as JSON files

## CLI Commands

### List Manufacturers

```bash
ofml manufacturers /path/to/ofmldata
```

Options:
- `--json`: Output as JSON for programmatic use

### List Articles

```bash
ofml articles /path/to/ofmldata <manufacturer>
```

Example:
```bash
ofml articles /workspace/ofmldata vitra
```

### Configure Product

```bash
ofml configure /path/to/ofmldata <manufacturer> <article> [--] [property=value ...]
```

Options:
- `--json`: Output configuration as JSON
- `--price-date YYYY-MM-DD`: Use specific date for pricing
- `--list-properties`: Show available properties without configuring
- `--export <path>`: Save configuration to JSON file

Examples:
```bash
# Configure with default properties
ofml configure /workspace/ofmldata vitra ViTable_Round

# Set specific properties
ofml configure /workspace/ofmldata vitra ViTable_Round -- height=720 diameter=1200 color=white

# Export configuration
ofml configure /workspace/ofmldata vitra ViTable_Round --export config.json
```

### Interactive TUI

```bash
ofml tui /path/to/ofmldata [--price-date YYYY-MM-DD]
```

## TUI Navigation

### Keyboard Shortcuts

| Key | Action |
|-----|--------|
| `↑`/`↓` | Navigate list |
| `Enter` | Select/drill down |
| `Esc` | Go back |
| `Tab`/`Shift+Tab` | Navigate properties |
| `/` | Search/filter |
| `e` | Export configuration |
| `d` | Set price date |
| `?` | Show help |
| `q` | Quit |

### Screen Flow

1. **Manufacturers** - List of available manufacturers
2. **Articles** - Articles for selected manufacturer
3. **Properties** - Property form for selected article

## Variant Codes

Variant codes are generated by concatenating property values in sort order:

```
<value1>_<value2>_<value3>_...
```

Example: `720_1200_white` for height=720, diameter=1200, color=white

## Export Format

Exports use JSON format per the schema in `contracts/export-schema.json`:

```json
{
  "manufacturer_id": "vitra",
  "article_id": "ViTable_Round",
  "variant_code": "720_1200_white",
  "properties": {
    "height": 720,
    "diameter": 1200,
    "color": "white"
  },
  "base_price": "1.234,56",
  "surcharges": [],
  "total_price": "1.234,56",
  "currency": "EUR",
  "price_date": "2025-12-24",
  "exported_at": "2025-12-24T10:30:00Z"
}
```

## German Formatting

All prices use German number formatting:
- Thousands separator: `.`
- Decimal separator: `,`
- Example: `12.345,67 EUR`

## Verbosity Levels

Use `-v`, `-vv`, or `-vvv` flags for increased logging:

```bash
ofml -vv manufacturers /workspace/ofmldata
```

| Level | Output |
|-------|--------|
| (none) | Errors only |
| `-v` | Warnings |
| `-vv` | Info |
| `-vvv` | Debug/Trace |

## Integration with OFML Data

The configurator works with OFML manufacturer data directories containing:
- `oap/` - Product ALB archives
- `elm/` - Element databases
- `prg/` - Program databases

## Technical Details

### Modules

- `oap/mod.rs` - Core types (Manufacturer, Article, PriceResult)
- `oap/config.rs` - Configuration state management
- `oap/variant.rs` - Variant code generation
- `oap/price.rs` - Price lookup service
- `oap/property.rs` - Property resolution from CLS
- `oap/actions.rs` - OAP action processing
- `tui/` - Terminal UI components (ratatui)

### Dependencies

- `ratatui` + `crossterm` - Terminal UI (optional, `tui` feature)
- `clap` - CLI argument parsing
- `rust_decimal` - Price calculations
- `chrono` - Date handling
- `tracing` - Logging
